{#
  Macro Collection
  ================
#}

{# ===================================================== #}
{# ---------------- Internal Macros -------------------- #}
{# ===================================================== #}

{#
  AmNav Builder
  =============
  Needed for SiteNavigation with Am Nav

  @private
#}
{% macro addNodeToNavigation(node, index) %}
  {%- set nodeClasses = [] -%}
  {%- if node.hasChildren -%}
    {%- set nodeClasses = nodeClasses|merge(['has-children']) -%}
  {%- endif -%}
  {%- if node.active or node.hasActiveChild -%}
    {%- set nodeClasses = nodeClasses|merge(['is-active']) -%}
  {%- endif -%}
  {%- if node.level == 1 and index == 1 -%}
    {%- set nodeClasses = nodeClasses|merge(['first']) -%}
  {%- endif -%}
  {%- if node.listClass|length -%}
    {%- set nodeClasses = nodeClasses|merge([node.listClass]) -%}
  {%- endif -%}

  <a href="{{ node.url }}" role="link" {% if nodeClasses|length %} class="{{ nodeClasses|join(' ') }}"{% endif %} title="{{ node.name }}"{% if node.blank %}  target="_blank"{% endif %}>{{ node.name }}</a>
{% endmacro %}

{#
  AmNav Sitenav Warning
  =============
  Needed for SiteNavigation with Am Nav

  @private
#}
{% macro siteNavWarn(nav) %}
  {% if craft.amNav.getNavName(nav) %}
    {% set nav = craft.amNav.getNavRaw(nav) %}
    {% if nav is defined %}
      {% for node in nav %}
        {{ _self.addNodeToNavigation(node, loop.index) }}
      {% endfor %}
    {% endif %}
  {% else %}
    <div style="color:red"><b style="color:red">A&M Nav</b> Please add `{{ nav }}` Navigation</div>
  {% endif %}
{% endmacro %}

{# ===================================================== #}
{# ----------------- Regular Macros -------------------- #}
{# ===================================================== #}

{#
  Media Image Set
  ===============
  Build a Image Element as regular `<img>` or fill a element with a background image.

  @param {array}  photo               = Image Array
  @param {string} imageratio          = Optional Imageratio [nocrop, '16:6', '1:1'...]
  @param {object} options             = Array of options
  @param {string} options.class       = Classname from the Element
  @param {bool}   options.background  = Background Option
  @param {string} options.elementtype = Typedefinition from Background Image Element
  @param {number} options.quality     = JPEG Compression,
  @param {array}  options.sizes       = Array with Imagesizes
#}
{% macro mediaImageSet(photo,imageratio,options) %}

  {# Default Values - can be overwritten #}
  {% set opt = {
    class: 'o-media-object__image',
    background: false,
    elementtype: 'figure',
    quality: 82,
    sizes: [
      { width: 1900 },
      { width: 1200 },
      { width: 800 },
      { width: 500 },
      { width: 320 },
      { width: 150 },
      { width: 30 } ]
  } %}

  {# Merging Arrays  #}
  {% set options = options ? opt|merge(options) : opt %}

  {# Check if Image is Available otherwise use a neutral Placeholder #}
  {% if photo %}
    {# Check if image would cropped#}
    {% if imageratio != 'nocrop' %}
      {% set ratio = imageratio|default('35:24')|split(':') %}
      {% set focusPosition = photo.focalpoint is defined ? photo.focalpoint : '50% 50%' %}
      {% set globalModifier = { jpegQuality: options.quality, ratio: ratio|first/ratio|last , mode: 'crop', position: focusPosition } %}

    {% else %}
      {% set globalModifier = { jpegQuality: options.quality } %}
    {% endif %}

    {# Build the Image Set #}
    {% set photos = craft.imager.transformImage(photo, options.sizes, globalModifier) %}

    {# Output as <img> or Background #}
    {% if (options.background) %}
      <{{ options.elementtype }} class="{{ options.class }} lazyload" style="background-image: url({{ photos|last.url }})" data-sizes="auto" data-bgset="{{ craft.imager.srcset( photos ) }}"></{{ options.elementtype }}>
    {% else %}
      <img class="{{ options.class }} lazyload" data-sizes="auto" src="{{ photos|last.url }}" data-srcset="{{ craft.imager.srcset( photos ) }}" role="img" {% if photo.title %}alt="{{ photo.title }}"{% endif %} itemprop="thumbnail">
    {% endif %}
  {% endif %}
{% endmacro %}

{#
  Pagination
  ==========
  Generate navigation buttons for paginations
  It use the Pagination Module, include before the Loop `{% paginate entries as pageInfo, pageEntries %}`

  @param {object}  pages                 - Pagination Object
  @param {object}  craft                 - Craft Request Object
  @param {object}  options               - Array of options
  @param {string}  options.class         - Classname (default: 'o-pagination')
  @param {stting}  options.searchquery   - To pass search words from Searchfields (default: false)
  @param {number}  options.pagenuber     - How many Pagebuttons are to be displayed. At 0, the display of the page buttons is omitted
  @param {string}  options.firstPageSign - HTML Sign for FirstPage
  @param {string}  options.lastPageSign  - HTML Sign for LastPage
  @param {string}  options.prevSign      - HTML Sign for Prev
  @param {string}  options.nextSign      - HTML Sign for Next
  @param {string}  options.firstPageText - Titletext for Firstpage
  @param {string}  options.lastPageText  - Titletext for Lastpage
  @param {string}  options.prevText      - Titletext for Prev
  @param {string}  options.nextText      - Titletext for Next
  @param {string}  options.jumpText      - Titletext for Jump
#}
{% macro pagination(pages,craft,options) %}
  {% set opt = {
    'class': 'o-pagination',
    'searchquery': false,
    'pagenumber': 5,
    'fistPageSign': '&laquo;',
    'lastPageSign': '&raquo;',
    'prevSign': '&lsaquo;',
    'nextSign': '&rsaquo;',
    'firstPageText': 'Zur ersten Seite',
    'lastPageText': 'Zur letzten Seite',
    'prevText': 'Zurück zur vorhergehenden Seite',
    'nextText': 'Weiter zur nächsten Seite',
    'jumpText': 'Sprung zur Seite'
  } %}

  {# Merge Options with Defaults #}
  {% set options = options ? opt|merge(options) : opt %}

  {# Add Pagination only if the Page Number is higher than 1#}
  {% if pages.totalPages > 1 %}

    <nav class="{{ options.class }}" role="navigation">
      {# Dont display last page when on the first Page #}
      {% if pages.currentPage > 2 and pages.prevUrl %}
        <a class="{{ options.class }}__link---text" href="{{ pages.firstUrl }}{{ options.searchquery ? '?q='~options.searchquery }}" title="{{ options.firstPageText }}">{{ options.fistPageSign|raw }}</a>
      {% endif %}

      {# Display the Previous Link if available #}
      {% if pages.prevUrl %}
        <a class="{{ options.class }}__link---text" href="{{ pages.prevUrl }}{{ options.searchquery ? '?q='~options.searchquery }}" title="{{ options.prevText }}">{{ options.prevSign|raw }}</a>
      {% endif %}

      {# With Pagenumber higher than zero the pagination will display pages #}
      {% if options.pagenumber > 0 %}
        {# Display prev 5 Page Links#}
        {% for page, url in pages.getPrevUrls(options.pagenumber) %}
          <a class="{{ options.class }}__link---number" href="{{ url }}{{ options.searchquery ? '?q='~options.searchquery }}" title="{{ options.jumpText }} {{ page }}">{{ page }}</a>
        {% endfor %}

        {# Diplay Current Page#}
        <span class="{{ options.class }}__link---current">{{ pages.currentPage }}</span>

        {# Display next 5 Page Links #}
        {% for page, url in pages.getNextUrls(options.pagenumber) %}
          <a class="{{ options.class }}__link---number" href="{{ url }}{{ options.searchquery ? '?q='~options.searchquery }}" title="{{ options.jumpText }} {{ page }}">{{ page }}</a>
        {% endfor %}
      {% endif %}

      {# Display next Page Link if available#}
      {% if pages.nextUrl %}
        <a class="{{ options.class }}__link---text" href="{{ pages.nextUrl }}{{ options.searchquery ? '?q='~options.searchquery }}" title="{{ options.nextText }}">{{ options.nextSign|raw }}</a>
      {% endif %}

      {# Dont display when on the last page #}
      {% if (pages.totalPages - 1) > pages.currentPage and pages.totalPages > 2 %}
        <a class="{{ options.class }}__link---text" href="{{ pages.lastUrl }}{{ options.searchquery ? '?q='~options.searchquery }}" title="{{ options.lastPageText }}">{{ options.lastPageSign|raw }}</a>
      {% endif %}
    </nav>
  {% endif %}
{% endmacro %}

{#
  Site Navigation
  ===============
#}
{% macro siteNavigation(classname,sectionPart) %}
  {% set class = classname|default('o-navigation') %}

  <nav class="{{ classname }}" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
    {% switch sectionPart %}
      {% case 'footernav' %}
        {{ _self.siteNavWarn('footerNavigation') }}
      {% case 'mainnav' %}
        {{ _self.siteNavWarn('mainNavigation') }}
    {% endswitch %}
  </nav>
{% endmacro %}

{#
  Social Share Macro
  ==================
  Works with SeoMatic

  @param {object} networks = Possible Social Networks
  @param {bool}   networks.facebook
  @param {bool}   networks.twitter
  @param {bool}   networks.googleplus
  @param {bool}   networks.pinterest
  @param {bool}   networks.mail
  @param {bool}   networks.whatsapp

  @param {object} options     = Config Options
  @param {string} class       = Classname
  @param {*}      request     = Request URL
  @param {*}      description = Seo Description
  @param {*}      image       = Seo Image URL
  @param {*}      title       = Seo Title
  @param {bool}   icon        = Option that activate SVG Share Icons
  @param {string} iconpath    = Path to icons
  @param {string} iconname    = Iconfile Name (Sprite)
  @param {string} iconprefix  = Prefix for icons
  @param {string} viewbox     = Viewbox Size
#}
{% macro socialShare(networks, options) %}
  {# Array for Networks #}
  {% set net = {
    'facebook': true,
    'twitter': true,
    'googleplus': true,
    'pinterest': true,
    'mail': false,
    'whatsapp': false
  } %}

  {# Option Array #}
  {% set opt = {
    'class': 'o-socialshare',
    'request': craft.request.url,
    'description': seomaticMeta.seoDescription,
    'image': seomaticMeta.seoImage,
    'title': seomaticMeta.seoTitle,
    'icon': true,
    'iconpath': '/assets/img/',
    'iconname': 'symbol-sprite.svg',
    'iconprefix': 'icon-',
    'viewbox': '0 0 20 20'
  } %}

  {# Merge Options with Defaults #}
  {% set networks = networks ? net|merge(networks) : net %}
  {% set options = options ? opt|merge(options) : opt %}

  {# Build Share URLs #}
  {% set shareUrl = {
    'facebook': 'http://www.facebook.com/sharer.php?u='~options.request,
    'twitter': 'http://twitter.com/share?url='~options.request~'&amp;text='~options.description,
    'googleplus': 'https://plus.google.com/share?url='~options.request,
    'pinterest': '//pinterest.com/pin/create/link/?url='~options.request~'&amp;media='~options.image~'&amp;description='~options.description|e,
    'mail': 'mailto:?Subject='~options.title~'&Body=%20'~options.request,
    'whatsapp': 'whatsapp://send?text='~options.request~' '~options.description
  } %}

  {# Building Block - Modify structure if needed #}
  <nav role="navigation" class="{{ options.class }}">
    {% for key, network in networks if network != false %}
      {% if options.icon == true %}<div class="{{ options.class }}__box">{% endif %}
      <a href="{{ shareUrl[key] }}" target="_blank" class="{{ options.class }}__link" title="Share with {{ key|capitalize }}">
        {% if options.icon == true %}
          <svg class="{{ options.class }}__icon" viewBox="{{ options.viewbox }}">
            <use xlink:href="{{ options.iconpath }}{{ options.iconname }}#{{ options.iconprefix}}{{ key }}"></use>
          </svg>
        {% else %}
          {{ key }}
        {% endif %}
      </a>
      {% if options.icon == true %}</div>{% endif %}
    {% endfor %}
  </nav>
{% endmacro %}


{#
  Social Link Macro
  ==================
  Simple Links to the Social Network Fanpages

  @param {object} options     = Config Options
  @param {string} class       = Classname
  @param {bool}   icon        = Option that activate SVG Share Icons
  @param {string} iconpath    = Path to icons
  @param {string} iconname    = Iconfile Name (Sprite)
  @param {string} iconprefix  = Prefix for icons
  @param {string} viewbox     = Viewbox Size
  @param {object} links       = A Array with Linkentries
#}
{% macro socialLink(links, options) %}
  {# Set Links to the Default Field #}
  {% if main.socialLinks is defined %}
    {% set links = links|default(main.socialLinks) %}
  {% endif %}

  {% set opt = {
    'class': 'o-sociallink',
    'icon': true,
    'iconpath': '/assets/img/',
    'iconname': 'symbol-sprite.svg',
    'iconprefix': 'icon-',
    'viewbox': '0 0 20 20'
  } %}

  {# Merge Options with Defaults #}
  {% set options = options ? opt|merge(options) : opt %}

  {# Building Block - Modify structure if needed #}
  <nav role="navigation" class="{{ options.class }}">
    {% for link in links  %}
      {% if options.icon == true %}<div class="{{ options.class }}__box">{% endif %}
      <a href="{{ link.socialLink }}" target="_blank" class="{{ options.class }}__link" title="Share with {{ link.socialTitle }}">
        {% if options.icon == true %}
          <svg class="{{ options.class }}__icon" viewBox="{{ options.viewbox }}">
            <use xlink:href="{{ options.iconpath }}{{ options.iconname }}#{{ options.iconprefix }}{{ link.socialIcon }}"></use>
          </svg>
        {% else %}
          {{  link.socialIcon }}
        {% endif %}
      </a>
      {% if options.icon == true %}</div>{% endif %}
    {% endfor %}
  </nav>
{% endmacro %}


{#
  SVGIcon
  =======
  Insert SVG Icons in a easy way

  @param {string} icon                = Iconname
  @param {object} options             = Config Options
  @param {string} options.class       = Optional Classname
  @param {string} options.iconpath    = Path to icons
  @param {string} options.iconname    = Iconfile Name (Sprite)
  @param {string} options.iconprefix  = Prefix for icons
  @param {string} options.viewbox     = Viewbox Size
#}
{% macro svgicon(icon, options) %}
  {% set opt = {
    'class': false,
    'iconpath': '/assets/img/',
    'iconname': 'symbol-sprite.svg',
    'iconprefix': 'icon-',
    'viewbox': '0 0 20 20'
  } %}

  {# Merge Options with Defaults #}
  {% set options = options ? opt|merge(options) : opt %}

  {# Building Block - Modify structure if needed #}
  <svg{{ options.class ? ' class='~options.class }} viewBox="{{ options.viewbox }}">
    <use xlink:href="{{ options.iconpath }}{{ options.iconname }}#{{ options.iconprefix }}{{ icon }}"></use>
  </svg>
{% endmacro %}
